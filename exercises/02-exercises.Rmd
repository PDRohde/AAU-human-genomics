---
title: "Human Genomics"
subtitle: "Session 2: Population Genomics"
author:
  - name: "Palle Duun Rohde"
    url: https://pdrohde.github.io/
    affiliation: Genomic Medicine, Aalborg University
    email: palledr@hst.aau.dk
output: html_document
---
<style type="text/css">

body, td {
   font-size: 14px;
}
code.r{
  font-size: 12px;
}
pre {
  font-size: 12px
}
</style>
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = "/Users/fs61oo/Documents/GitHub/AAU-human-genomics/")
library(kableExtra)
```

### Part I
#### Exercise 1
Population geneticists analyze the extent and patterns of genetic variation within populations, the distribution of genotypes, and the influence of evolutionary forces like natural selection and genetic drift. These factors drive evolutionary change and speciation. Based on your current understanding, how would you address the following questions?

1.  How can we measure genetic variation within a population?
2.  How can we determine whether a population’s genetic structure is changing over time?
<br />
<br />

#### Exercise 2
Which term refers to the complete set of genetic information shared by all individuals within a population?

1.  Gene pool
2.  Genome
3.  Chromosome complement
4.  Breeding unit
5.  Race

Various mechanisms help preserve genetic diversity within a population. Why is maintaining this diversity beneficial?

1.  Homozygosity provides an evolutionary advantage.
2.  Increased diversity promotes inbreeding benefits.
3.  Genetic diversity enhances a population’s ability to adapt to environmental changes.
4.  Greater genetic diversity increases the likelihood of haploidy.
5.  Genetic diversity prevents diploidy.
<br />
<br />

#### Exercise 3
Human serum contains a protein called haptoglobin, which binds to hemoglobin following the lysis of erythrocytes. In some populations, three electrophoretic haptoglobin variants are observed, determined by three autosomal co-dominant alleles: A, B, and C. Among 500 individuals, the following genotype counts were recorded:

<style type="text/css">
.tg  {border-collapse:collapse;border-color:#ccc;border-spacing:0;}
.tg td{background-color:#fff;border-color:#ccc;border-style:solid;border-width:1px;color:#333;
  font-family:Arial, sans-serif;font-size:14px;overflow:hidden;padding:10px 5px;word-break:normal;}
.tg th{background-color:#f0f0f0;border-color:#ccc;border-style:solid;border-width:1px;color:#333;
  font-family:Arial, sans-serif;font-size:14px;font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}
.tg .tg-baqh{text-align:center;vertical-align:top}
.tg .tg-amwm{font-weight:bold;text-align:center;vertical-align:top}
.tg .tg-0lax{text-align:left;vertical-align:top}
</style>
<table class="tg"><thead>
  <tr>
    <th class="tg-amwm" colspan="6">No individuals</th>
    <th class="tg-amwm">Total</th>
  </tr></thead>
<tbody>
  <tr>
    <td class="tg-baqh">AA</td>
    <td class="tg-baqh">AB</td>
    <td class="tg-baqh">AC</td>
    <td class="tg-baqh">BB</td>
    <td class="tg-baqh">BC</td>
    <td class="tg-baqh">CC</td>
    <td class="tg-0lax"></td>
  </tr>
  <tr>
    <td class="tg-baqh">109</td>
    <td class="tg-baqh">123</td>
    <td class="tg-baqh">128</td>
    <td class="tg-baqh">33</td>
    <td class="tg-baqh">70</td>
    <td class="tg-baqh">37</td>
    <td class="tg-baqh">500</td>
  </tr>
</tbody>
</table>
<br />

1.  Compute the genotype frequencies within the sample.
2. Compute the allele frequency within the sample.
<br />
<br />

#### Exercise 4
Cystic fibrosis (CF) is an autosomal recessive disease. In individuals who are homozygous for the recessive allele, a malfunction in salt transport occurs in certain cell types, such as those in the lungs. This defect leads to thick mucus buildup, increasing the risk of bacterial lung infections.

Historically, only a small number of individuals with CF survived into adulthood. In Europe, the birth prevalence of CF has been approximately 1 in 2,500 newborns. This frequency is maintained by a balance between mutation and natural selection.

In a European sample, cystic fibrosis (CF) carrier status was analyzed based on three genotypes: 16,890 individuals were homozygous for the normal allele (<tt>RR</tt>), 855 individuals were heterozygous carriers (<tt>Rr</tt>), and 18 individuals were homozygous for the recessive CF allele (<tt>rr</tt>).

1.  Calculate the frequency of each allele in the sample.
<br />
<br />

#### Exercise 5
A geneticist studying a human population discovers that a recessive allele (<tt>s</tt>) associated with sickle cell disease is present in a community of 1,024 individuals. Individuals carrying two copies of the recessive allele (<tt>ss</tt>) develop sickle cell disease, while those with at least one dominant allele (<tt>S</tt>) have normal red blood cells. Within the population, 1 in 256 individuals has sickle cell disease, indicating they are homozygous recessive (<tt>ss</tt>).

1.	Assuming random mating and no selection for this gene, how many individuals with normal red blood cells are carriers of the recessive allele?
<br />
<br />

#### Exercise 6 
This exercise should be solved using <tt>R</tt>.

Run every step in the code below, and explain what each step does. 
```{r, eval=F}
# define alleles
  A1 <- "A"
  A2 <- "a"

# define frequency of A1
  p <- 0.2
  allele <- c(rep(A1,p*10),rep(A2,(1-p)*10))

# define population size
  N <- 100

# define population
  pop <- matrix(nrow=N, ncol=2)
  
  for(i in 1:nrow(pop)){
    pop[i, 1] <- sample(allele, 1)
    pop[i, 2] <- sample(allele, 1)
  }

# combine alleles into genotype
  pop <- cbind(pop, paste(pop[,1],pop[,2],sep=""))
```
<br />

We can count how many we have of each genotype using the `table(snp)` function.

1.  Determine the genotype and allele frequency. 
2.  Make sure you understand every step.

```{r, eval=F}
# genotype count
  obs.count <- table(pop[,3])

# combine the two heterozygote genotypes (Aa and aA is the same)
  pop[,3][pop[,3]=="aA"] <- "Aa"
  obs.count <- table(pop[,3])

# total number of observations
  Nobs <- sum(obs.count)

# genotype frequencies
  geno.freq <- obs.count / Nobs

# allele frequencies
  p.A <- (2*obs.count["AA"] + obs.count["Aa"]) / (2*Nobs)
  p.a <- (2*obs.count["aa"] + obs.count["Aa"]) / (2*Nobs)
```
<br />

3.  Does it match the expectation based on how you simulated the genotypes? 
4.  We can redo the simulations a number of times, and with different population sizes.
```{r, eval=F}
# set global parameters
  N <- seq(10,1000,10)
  rep <- 10
  A1 <- "A"
  A2 <- "a"
  p <- 0.2
  allele <- c(rep(A1,p*10),rep(A2,(1-p)*10))

  p.A <- matrix(nrow=rep, ncol=length(N))  
  colnames(p.A) <- N
  rownames(p.A) <- paste("rep",1:rep,sep="")
  
# run simulations
  for(i in 1:length(N)){
    for(j in 1:rep){
      pop <- matrix(nrow=N[i], ncol=2)  
      
      for(k in 1:nrow(pop)){
        pop[k, 1] <- sample(allele, 1)
        pop[k, 2] <- sample(allele, 1)
      }
    pop <- cbind(pop, paste(pop[,1],pop[,2],sep=""))
    pop[,3][pop[,3]=="aA"] <- "Aa"
    
    obs.count <- table(pop[,3])
    Nobs <- sum(obs.count)
    geno.freq <- obs.count / Nobs
    p.A[j,i] <- (2*obs.count["AA"] + obs.count["Aa"]) / (2*Nobs)
    }
  }

```

5.  Why does the matrix `p.A` contains many values that are `NA` ?
6.  Visualise the results from these simulations. What do you see?
```{r, eval=F}
library(ggplot2)
library(reshape2)
p.A <- melt(p.A)
ggplot(p.A[!is.na(p.A$value),], aes(x = Var2, y = value, fill = factor(Var2))) +
  geom_hline(yintercept = p, linetype = "dashed", color = "darkorange", linewidth = 0.75) +
  geom_boxplot(alpha = 0.6) + 
   coord_cartesian(ylim = c(0.1, 0.35)) +
  labs(x = "N", y = "p(A)", title = "") +
  theme_classic() + theme(legend.position = "none") 
```
<br />
<br />

#### Exercise 7
In the second part of these exercises, we will examine deviations from expected genotype frequencies. According to the Hardy-Weinberg principle, genotype frequencies can be predicted from allele frequencies under certain assumptions. Specifically, if allele A has a frequency of p and allele a has a frequency of q, the expected genotype frequencies are:

-  <tt>AA</tt> $p^2$
-  <tt>Aa</tt> $2pq$
-  <tt>aa</tt> $q^2$

Next, we will create a figure that visualizes the predicted genotype frequencies for different values of p. Take the time to review and understand the code used to generate it.
```{r, fig.align='center',fig.width=5,fig.height=4}
curve(2*x*(1-x),col="darkblue", ylim=c(0,1), lwd=2, xlab="Allele frequency", ylab="Genotype frequency", las=1)
  text(x=0.5, y=0.7, labels="Aa", col="darkblue", font=2)
curve(x**2,col="darkgreen", add=T, ylab="NULL", ylim=c(0,1), lwd=2)
  text(x=0.9, y=0.7, labels="AA", col="darkgreen", font=2)
curve((1-x)**2,col="darkred",add=T, ylab="NULL", ylim=c(0,1),lwd=2)
  text(x=0.1, y=0.7, labels="aa", col="darkred", font=2)
```
<br />
<br />

### Part II

#### Exercise 8
In a study of 10,000 individuals of Danish ancestry, researchers analyzed two genetic loci, including the _CFTR_ gene (associated with cystic fibrosis) and the <tt>APOE</tt> gene (linked to Alzheimer’s disease risk). These loci were chosen due to their well-established roles in disease susceptibility and health outcomes, providing insights into the genetic factors influencing these conditions in the population.

<style type="text/css">
.tg  {border-collapse:collapse;border-spacing:0;}
.tg td{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
  overflow:hidden;padding:10px 5px;word-break:normal;}
.tg th{border-color:black;border-style:solid;border-width:1px;font-family:Arial, sans-serif;font-size:14px;
  font-weight:normal;overflow:hidden;padding:10px 5px;word-break:normal;}
.tg .tg-c3ow{border-color:inherit;text-align:center;vertical-align:top}
.tg .tg-0pky{border-color:inherit;text-align:left;vertical-align:top}
</style>
<table class="tg"><thead>
  <tr>
    <th class="tg-c3ow" colspan="3"><span style="font-weight:bold;font-style:italic">CFTR</span></th>
    <th class="tg-0pky"></th>
    <th class="tg-c3ow" colspan="3"><span style="font-weight:bold;font-style:italic">APO</span><span style="font-weight:bold">E</span></th>
  </tr></thead>
<tbody>
  <tr>
    <td class="tg-c3ow">WT | WT</td>
    <td class="tg-c3ow">WT | F508del<br></td>
    <td class="tg-c3ow">F508del | F508del</td>
    <td class="tg-c3ow"></td>
    <td class="tg-c3ow">ε3 | ε3</td>
    <td class="tg-c3ow">ε3 | ε4</td>
    <td class="tg-c3ow">ε4 | ε4</td>
  </tr>
  <tr>
    <td class="tg-c3ow"><span style="color:black">3156</span></td>
    <td class="tg-c3ow"><span style="color:black">4997</span></td>
    <td class="tg-c3ow"><span style="color:black">1847</span></td>
    <td class="tg-c3ow"></td>
    <td class="tg-c3ow"><span style="color:black">6837</span></td>
    <td class="tg-c3ow"><span style="color:black">3065</span></td>
    <td class="tg-c3ow"><span style="color:black">98</span></td>
  </tr>
</tbody></table>
<br />
<br />

1.  Compute the allele- and genotype frequencies for the two alleles in both the _CFTR_- and _APOE_-locus.
2.  Perform the necessary calculations to determine whether the allele frequencies at the two loci follow Hardy-Weinberg equilibrium proportions.

<br />
<br />









